<!DOCTYPE html>
<html lang="hi" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drownford Academy - AI Learning Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Drownford Professional (Deep Blue, Gold, White) -->
    <!-- Application Structure Plan: The application is now a multi-view SPA simulating a full educational platform named "Drownford Academy". It includes a client-side login/signup flow using localStorage. Post-login, a user-specific dashboard is presented. The structure is highly modular with views for Dashboard, Roadmap, Notebook, Progress, and AI Chat, all accessible via a redesigned sidebar. This creates a personalized, high-level, and scalable learning environment. -->
    <!-- Visualization & Content Choices: 
        1. Login/Dashboard: A simulated auth flow to create a personalized experience. The dashboard provides a high-level summary of progress and quick access to other sections.
        2. Notebook: Redesigned as a "digital book" with a more immersive UI for reading and editing notes, enhancing the user experience.
        3. All previous features (Roadmap, Progress, AI Chat, Gemini tools) are retained but integrated into the new, more professional UI for a cohesive feel.
        4. API Key Management: Added a settings modal for users to input their own Gemini API key, which is stored in localStorage. This solves the hosting issue securely.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', 'Noto Sans Devanagari', sans-serif;
            background-color: #f0f4f8;
        }
        .main-content {
            transition: margin-left 0.3s ease;
        }
        .sidebar {
            transition: transform 0.3s ease;
        }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        .gemini-modal, .auth-modal, .settings-modal {
            transition: opacity 0.3s ease;
        }
        .loader {
            border-top-color: #4338ca;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .chat-bubble { max-width: 80%; }
        .chat-bubble-user { background-color: #dbeafe; }
        .chat-bubble-ai { background-color: #e5e7eb; }
        .notebook-container {
            perspective: 2000px;
        }
        .notebook {
            width: 100%;
            height: 80vh;
            position: relative;
            transition: transform 0.5s;
            transform-style: preserve-3d;
        }
        .notebook-page {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            background-color: #fff;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            overflow-y: auto;
        }
        .notebook-page.front {
            z-index: 1;
        }
        .notebook-page.back {
            transform: rotateY(180deg);
        }
    </style>
</head>
<body class="bg-slate-100">

    <!-- Auth Modal -->
    <div id="auth-modal" class="auth-modal fixed inset-0 bg-gray-900 bg-opacity-60 z-[80] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full">
            <div id="auth-view-container" class="p-8 text-center">
                 <h1 class="text-2xl font-extrabold tracking-wider text-gray-800">Drownford Academy</h1>
                 <p class="text-gray-500 mt-2 mb-8">AI рд╕реАрдЦрдиреЗ рдХреЗ рднрд╡рд┐рд╖реНрдп рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИред</p>
                 <button id="google-signin-btn" class="w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-50 transition-colors">
                    <span class="mr-3 text-xl">G</span> Sign in with Google
                 </button>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="settings-modal fixed inset-0 bg-black bg-opacity-50 z-[60] flex items-center justify-center p-4 hidden opacity-0">
        <div class="bg-white rounded-lg shadow-xl max-w-lg w-full">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 class="text-xl font-bold">API Key Settings</h3>
                <button id="settings-modal-close" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <div class="p-6">
                <p class="text-gray-600 mb-4">AI features рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдХреГрдкрдпрд╛ рдЕрдкрдиреА Gemini API key рдбрд╛рд▓реЗрдВред рдЖрдкрдХреА key рдХреЗрд╡рд▓ рдЖрдкрдХреЗ browser рдореЗрдВ save рд╣реЛрдЧреАред</p>
                <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-indigo-600 hover:underline mb-4 block">рдпрд╣рд╛рдБ рд╕реЗ рдЕрдкрдиреА free API key рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред</a>
                <input id="api-key-input" type="password" placeholder=" рдЕрдкрдиреА API key рдпрд╣рд╛рдБ рдкреЗрд╕реНрдЯ рдХрд░реЗрдВ" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                <button id="save-api-key-btn" class="w-full mt-4 bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700 transition-colors">Save Key</button>
            </div>
        </div>
    </div>

    <!-- Main App Structure (hidden by default) -->
    <div id="app-container" class="hidden">
        <div class="flex h-screen bg-white">
            <!-- Sidebar -->
            <aside id="sidebar" class="sidebar w-64 bg-gray-900 text-white flex-col fixed h-full z-40 transform -translate-x-full md:translate-x-0">
                <div class="px-6 py-5 border-b border-gray-700 flex items-center space-x-3">
                    <span class="text-3xl">ЁЯОУ</span>
                    <h1 class="text-xl font-extrabold tracking-wider">Drownford Academy</h1>
                </div>
                <nav class="flex-1 px-4 py-4 space-y-2">
                    <a href="#dashboard" class="nav-link flex items-center px-4 py-2.5 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors">
                        <span class="mr-3">ЁЯПа</span> Dashboard
                    </a>
                    <a href="#roadmap" class="nav-link flex items-center px-4 py-2.5 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors">
                        <span class="mr-3">ЁЯЪА</span> AI Roadmap
                    </a>
                    <a href="#notebook" class="nav-link flex items-center px-4 py-2.5 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors">
                        <span class="mr-3">ЁЯУЦ</span> Notebook
                    </a>
                    <a href="#progress" class="nav-link flex items-center px-4 py-2.5 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors">
                        <span class="mr-3">ЁЯУК</span> Meri Progress
                    </a>
                    <a href="#chat" class="nav-link flex items-center px-4 py-2.5 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors">
                        <span class="mr-3">ЁЯдЦ</span> AI se Puchein
                    </a>
                </nav>
                <div class="px-6 py-4 border-t border-gray-700">
                    <button id="logout-btn" class="w-full flex items-center justify-center px-4 py-2.5 text-gray-300 bg-red-800/50 hover:bg-red-700/80 rounded-lg transition-colors">
                        <span class="mr-3">ЁЯЪк</span> Logout
                    </button>
                </div>
            </aside>

            <!-- Main Content -->
            <div id="main-content" class="main-content flex-1 flex flex-col h-screen md:ml-64">
                 <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-30 flex items-center justify-between px-6 py-4">
                    <button id="menu-toggle" class="text-gray-600 md:hidden">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>
                    <h2 id="view-title" class="text-2xl font-bold text-gray-800">Dashboard</h2>
                    <div class="flex items-center space-x-4">
                        <span class="font-semibold text-gray-600">Welcome, <span id="username-display"></span>!</span>
                        <button id="settings-btn" class="text-gray-600 hover:text-indigo-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        </button>
                    </div>
                </header>
                
                <main class="flex-1 overflow-y-auto p-4 sm:p-6 md:p-8 bg-gray-50">
                    <!-- Views will be injected here -->
                    <div id="dashboard-view" class="view"></div>
                    <div id="roadmap-view" class="view hidden"></div>
                    <div id="notebook-view" class="view hidden"></div>
                    <div id="progress-view" class="view hidden"></div>
                    <div id="chat-view" class="view hidden"></div>
                </main>
            </div>
        </div>
    </div>
    
    <!-- Gemini API Response Modal -->
    <div id="gemini-modal" class="gemini-modal fixed inset-0 bg-black bg-opacity-50 z-[60] flex items-center justify-center p-4 hidden opacity-0">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 id="gemini-modal-title" class="text-xl font-bold"></h3>
                <button id="gemini-modal-close" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <div id="gemini-modal-content" class="p-6 overflow-y-auto" style="white-space: pre-wrap;"></div>
        </div>
    </div>
    
    <!-- Loading Indicator -->
    <div id="loading-indicator" class="fixed inset-0 bg-black bg-opacity-25 z-[70] flex items-center justify-center hidden">
        <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-24 w-24"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- App State and Data ---
            const roadmapData = [
                { id: 'charan-1', title: 'рдмреБрдирд┐рдпрд╛рдж рдордЬрд╝рдмреВрдд рдХрд░реЗрдВ', duration: '3-4 рдорд╣реАрдиреЗ', topics: [
                    { id: 'math', title: 'рдЧрдгрд┐рдд (Mathematics)', items: ['Linear Algebra', 'Calculus', 'Probability & Statistics'] },
                    { id: 'programming', title: 'рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ (Programming)', items: ['Python (Must Have)', 'Libraries: NumPy, Pandas, Matplotlib'] },
                    { id: 'tools', title: 'рдЬрд╝рд░реВрд░реА рдЯреВрд▓реНрд╕ (Essential Tools)', items: ['Jupyter Notebooks / Google Colab', 'Git & GitHub', 'SQL'] }
                ]},
                { id: 'charan-2', title: 'Data Science рдФрд░ Machine Learning', duration: '4-6 рдорд╣реАрдиреЗ', topics: [
                    { id: 'ds-process', title: 'Data Science рдкреНрд░рдХреНрд░рд┐рдпрд╛', items: ['Data Collection', 'Data Cleaning & Preprocessing', 'Exploratory Data Analysis (EDA)'] },
                    { id: 'ml-core', title: 'Machine Learning рдХреЗ рд╕рд┐рджреНрдзрд╛рдВрдд', items: ['Supervised Learning', 'Unsupervised Learning'] },
                    { id: 'model-building', title: 'рдореЙрдбрд▓ рдмрдирд╛рдирд╛ рдФрд░ рд╕реБрдзрд╛рд░рдирд╛', items: ['Feature Engineering', 'Model Evaluation Metrics', 'Hyperparameter Tuning'] }
                ]},
                { id: 'charan-3', title: 'Deep Learning рдореЗрдВ рдЧрд╣рд░рд╛рдИ', duration: '4-6 рдорд╣реАрдиреЗ', topics: [
                    { id: 'nn-basics', title: 'Neural Networks рдХреА рдореВрд▓ рдмрд╛рддреЗрдВ', items: ['Artificial Neural Networks (ANN)', 'Activation Functions, Backpropagation'] },
                    { id: 'dl-frameworks', title: 'Deep Learning Frameworks', items: ['TensorFlow рдпрд╛ PyTorch'] },
                    { id: 'advanced-arch', title: 'рдПрдбрд╡рд╛рдВрд╕реНрдб рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░', items: ['CNNs', 'RNNs & LSTMs', 'Transformers'] }
                ]},
                { id: 'charan-4', title: 'рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рдХрд▓ рдЕрдиреБрднрд╡', duration: 'рд╣рдореЗрд╢рд╛ рдЬрд╛рд░реА', topics: [
                    { id: 'projects', title: 'рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдмрдирд╛рдПрдБ (Build Projects)', items: ['рдЫреЛрдЯреЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ', 'рдмрдбрд╝реЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдкрд░ рдХрд╛рдо рдХрд░реЗрдВ', 'GitHub рдкрд░ рдкреЛрд░реНрдЯрдлреЛрд▓рд┐рдпреЛ рдмрдирд╛рдПрдБ'] },
                    { id: 'competitions', title: 'рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛рдУрдВ рдореЗрдВ рднрд╛рдЧ рд▓реЗрдВ', items: ['Kaggle рдкрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ', 'рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдбреЗрдЯрд╛рд╕реЗрдЯ рдкрд░ рдХрд╛рдо рдХрд░реЗрдВ'] }
                ]},
                { id: 'charan-5', title: 'рд╡рд┐рд╢реЗрд╖рдЬреНрдЮрддрд╛ рдФрд░ MLOps', duration: 'рд╣рдореЗрд╢рд╛ рдЬрд╛рд░реА', topics: [
                    { id: 'specialization', title: 'рдХрд┐рд╕реА рдПрдХ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮрддрд╛', items: ['Computer Vision', 'Natural Language Processing (NLP)', 'Reinforcement Learning'] },
                    { id: 'mlops', title: 'MLOps', items: ['Model Deployment', 'Containerization (Docker)', 'Cloud Platforms (AWS, GCP)'] }
                ]}
            ];
            let currentUser = null;

            // --- UI Element References ---
            const authModal = document.getElementById('auth-modal');
            const appContainer = document.getElementById('app-container');
            const views = document.querySelectorAll('.view');
            const navLinks = document.querySelectorAll('.nav-link');
            const viewTitle = document.getElementById('view-title');
            const usernameDisplay = document.getElementById('username-display');
            const logoutBtn = document.getElementById('logout-btn');
            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.getElementById('sidebar');
            const settingsModal = document.getElementById('settings-modal');

            // --- AUTHENTICATION ---
            function renderAuthView() {
                document.getElementById('google-signin-btn').addEventListener('click', handleGoogleSignIn);
            }

            function handleGoogleSignIn() {
                // Simulate Google Sign-In
                const email = prompt("Simulated Google Sign-in:\nPlease enter your email to login or sign up.", "student@drownford.com");
                if (!email || !email.includes('@')) {
                    alert('Please enter a valid email.');
                    return;
                }
                
                currentUser = email;
                localStorage.setItem('drownford_currentUser', currentUser);
                initializeApp();
            }

            function handleLogout() {
                currentUser = null;
                localStorage.removeItem('drownford_currentUser');
                localStorage.removeItem('gemini_api_key');
                authModal.classList.remove('hidden');
                appContainer.classList.add('hidden');
            }
            logoutBtn.addEventListener('click', handleLogout);

            // --- VIEW RENDERING ---
            function renderDashboardView() {
                const container = document.getElementById('dashboard-view');
                const overallProgress = calculateOverallProgress();
                container.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
                            <h3 class="font-bold text-lg text-gray-500 mb-2">Overall Progress</h3>
                            <p class="text-5xl font-extrabold text-indigo-600">${overallProgress.toFixed(0)}%</p>
                            <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4">
                                <div class="bg-indigo-600 h-2.5 rounded-full" style="width: ${overallProgress}%"></div>
                            </div>
                        </div>
                         <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
                            <h3 class="font-bold text-lg text-gray-500 mb-2">Topics Completed</h3>
                            <p class="text-5xl font-extrabold text-green-600">${getCompletedTopicCount()}</p>
                             <p class="text-gray-500 mt-4">out of ${roadmapData.flatMap(s => s.topics).length} total topics</p>
                        </div>
                         <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
                            <h3 class="font-bold text-lg text-gray-500 mb-2">Quick Actions</h3>
                            <div class="mt-4 space-y-2">
                                <a href="#roadmap" class="nav-link-action block text-center w-full bg-blue-100 text-blue-800 p-3 rounded-lg font-semibold hover:bg-blue-200 transition-colors">Continue Learning ЁЯЪА</a>
                                <a href="#notebook" class="nav-link-action block text-center w-full bg-yellow-100 text-yellow-800 p-3 rounded-lg font-semibold hover:bg-yellow-200 transition-colors">View My Notes ЁЯУЦ</a>
                            </div>
                        </div>
                    </div>
                `;
                document.querySelectorAll('.nav-link-action').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        window.location.hash = new URL(link.href).hash;
                    });
                });
            }
            
            function renderRoadmapView() {
                const container = document.getElementById('roadmap-view');
                container.innerHTML = roadmapData.map(stage => `
                    <section id="${stage.id}" class="mb-12">
                        <div class="mb-8">
                            <span class="bg-indigo-100 text-indigo-800 text-sm font-medium mr-2 px-3 py-1 rounded-full">${stage.duration}</span>
                            <h3 class="text-3xl font-bold text-gray-800 mt-2">${stage.title}</h3>
                        </div>
                        <div class="space-y-4">
                            ${stage.topics.map(topic => `
                                <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200">
                                    <button class="accordion-button w-full text-left p-5 flex justify-between items-center hover:bg-gray-50 transition-colors">
                                        <div class="flex items-center">
                                            <input type="checkbox" class="progress-checkbox h-5 w-5 rounded text-indigo-600 focus:ring-indigo-500 border-gray-300 mr-4" data-topic-id="${topic.id}">
                                            <span class="text-lg font-semibold text-gray-800">${topic.title}</span>
                                        </div>
                                        <span class="arrow text-indigo-500 text-2xl font-bold transform transition-transform">тА║</span>
                                    </button>
                                    <div class="accordion-content bg-gray-50/50 hidden">
                                        <ul class="px-5 pt-2 pb-4 list-disc list-inside text-gray-700 space-y-2 ml-8">
                                            ${topic.items.map(item => `<li>${item}</li>`).join('')}
                                        </ul>
                                        <div class="notes-section border-t border-gray-200 p-5">
                                            <div class="flex flex-wrap gap-2 mb-4">
                                                <button class="gemini-explain-btn text-sm bg-purple-100 text-purple-800 px-3 py-1 rounded-full hover:bg-purple-200 transition-colors" data-title="${topic.title}">тЬи рдЗрд╕рд╕реЗ рд╕рдордЭрд╛рдУ</button>
                                                <button class="gemini-analogy-btn text-sm bg-teal-100 text-teal-800 px-3 py-1 rounded-full hover:bg-teal-200 transition-colors" data-title="${topic.title}">тЬи Analogy рджреЛ</button>
                                                <button class="gemini-question-btn text-sm bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full hover:bg-yellow-200 transition-colors" data-title="${topic.title}">тЬи Practice рд╕рд╡рд╛рд▓</button>
                                                <button class="gemini-project-btn text-sm bg-green-100 text-green-800 px-3 py-1 rounded-full hover:bg-green-200 transition-colors" data-title="${topic.title}">тЬи Project Ideas</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </section>
                `).join('');
                addAccordionListeners();
                addGeminiButtonListeners();
                addProgressCheckboxListeners();
                updateProgressCheckboxes();
            }

            function renderProgressView() {
                const container = document.getElementById('progress-view');
                const overallProgress = calculateOverallProgress();
                container.innerHTML = `
                    <div class="bg-white p-8 rounded-2xl shadow-lg">
                        <h2 class="text-3xl font-extrabold text-gray-900 mb-2">рдЖрдкрдХреА рд╕реАрдЦрдиреЗ рдХреА рдкреНрд░рдЧрддрд┐</h2>
                        <p class="text-gray-600 mb-8">рдЕрдкрдиреА рдкреНрд░рдЧрддрд┐ рдХреЛ рдЯреНрд░реИрдХ рдХрд░реЗрдВ рдФрд░ рдкреНрд░реЗрд░рд┐рдд рд░рд╣реЗрдВред</p>
                        
                        <div class="mb-10">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-bold text-gray-700">рдХреБрд▓ рдкреНрд░рдЧрддрд┐</span>
                                <span class="font-bold text-indigo-600">${overallProgress.toFixed(0)}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-4">
                                <div class="progress-bar-fill bg-indigo-600 h-4 rounded-full" style="width: ${overallProgress}%;"></div>
                            </div>
                        </div>

                        <div class="space-y-6">
                        ${roadmapData.map(stage => {
                            const stageProgress = calculateStageProgress(stage.id);
                            return `
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-semibold text-gray-600">${stage.title}</span>
                                    <span class="text-sm font-medium text-gray-500">${stageProgress.toFixed(0)}%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5">
                                    <div class="progress-bar-fill bg-green-500 h-2.5 rounded-full" style="width: ${stageProgress}%;"></div>
                                </div>
                            </div>
                            `
                        }).join('')}
                        </div>
                    </div>
                `;
            }

            function renderNotebookView() {
                const container = document.getElementById('notebook-view');
                let tocHTML = '<div class="w-full lg:w-1/3 p-4"><h3 class="text-2xl font-bold text-gray-800 mb-4">Table of Contents</h3><ul class="space-y-2">';
                let notesHTML = '<div class="w-full lg:w-2/3 p-4 space-y-8">';
                
                roadmapData.forEach(stage => {
                    notesHTML += `<h4 class="text-xl font-bold text-indigo-800 mt-6 border-b pb-2">${stage.title}</h4>`;
                    stage.topics.forEach(topic => {
                        const noteContent = getNote(topic.id) || '';
                        tocHTML += `<li><a href="#note-${topic.id}" class="text-indigo-600 hover:underline">${topic.title}</a></li>`;
                        notesHTML += `
                            <div id="note-${topic.id}" class="note-entry pt-4">
                                <h3 class="text-lg font-bold text-gray-700 mb-3">${topic.title}</h3>
                                <textarea class="note-textarea w-full h-36 p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition bg-gray-50" data-key="${topic.id}" placeholder="рдЗрд╕ рд╡рд┐рд╖рдп рдХреЗ рд▓рд┐рдП рдиреЛрдЯреНрд╕ рдпрд╣рд╛рдБ рд▓рд┐рдЦреЗрдВ...">${noteContent}</textarea>
                                <div class="flex justify-end items-center mt-3 space-x-3">
                                     <button class="gemini-summary-btn text-sm bg-cyan-100 text-cyan-800 px-3 py-1 rounded-full hover:bg-cyan-200 transition-colors" data-key="${topic.id}">тЬи Summarize</button>
                                     <span class="note-status text-sm text-green-600 opacity-0" data-key="${topic.id}">рд╕рд╣реЗрдЬрд╛ рдЧрдпрд╛!</span>
                                     <button class="save-note-btn bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition-colors text-sm" data-key="${topic.id}">рдиреЛрдЯреНрд╕ рд╕рд╣реЗрдЬреЗрдВ</button>
                                </div>
                            </div>
                        `;
                    });
                });
                tocHTML += '</ul></div>';
                notesHTML += '</div>';

                container.innerHTML = `
                    <div class="notebook-page p-4 sm:p-8 rounded-lg">
                        <h2 class="text-3xl font-bold text-gray-800 border-b pb-4 mb-6">My Digital Notebook</h2>
                        <div class="flex flex-col lg:flex-row">
                            ${tocHTML}
                            ${notesHTML}
                        </div>
                    </div>
                `;
                addNoteSavingListeners();
                addNoteGeminiListeners();
            }

            function renderChatView() {
                const container = document.getElementById('chat-view');
                container.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-lg h-[75vh] flex flex-col">
                        <div class="p-4 border-b">
                             <h2 class="text-xl font-bold text-gray-900">AI рд╕реЗ Puchein</h2>
                             <p class="text-sm text-gray-500">AI/ML рд╕реЗ рдЬреБрдбрд╝рд╛ рдХреЛрдИ рднреА рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВред</p>
                        </div>
                        <div id="chat-history" class="flex-1 p-6 overflow-y-auto space-y-4">
                            <div class="flex justify-start">
                                <div class="chat-bubble chat-bubble-ai p-3 rounded-lg">
                                    рдирдорд╕реНрддреЗ! рдореИрдВ рдЖрдкрдХрд╛ AI рд▓рд░реНрдирд┐рдВрдЧ рдЕрд╕рд┐рд╕реНрдЯреЗрдВрдЯ рд╣реВрдБред рдЖрдк рдореБрдЭрд╕реЗ AI, Machine Learning, рдпрд╛ рдЗрд╕ рд░реЛрдбрдореИрдк рд╕реЗ рдЬреБрдбрд╝рд╛ рдХреЛрдИ рднреА рд╕рд╡рд╛рд▓ рдкреВрдЫ рд╕рдХрддреЗ рд╣реИрдВред
                                </div>
                            </div>
                        </div>
                        <div class="p-4 border-t bg-gray-50">
                            <div class="flex items-center space-x-3">
                                <input type="text" id="chat-input" class="flex-1 w-full px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рдпрд╣рд╛рдБ рдЯрд╛рдЗрдк рдХрд░реЗрдВ...">
                                <button id="chat-send-btn" class="bg-indigo-600 text-white rounded-full p-3 hover:bg-indigo-700 transition-colors">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"></path></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                addChatListeners();
            }

            // --- Navigation ---
            function switchView(hash) {
                views.forEach(view => view.classList.add('hidden'));
                navLinks.forEach(link => link.classList.remove('bg-gray-700', 'text-white'));
                
                const activeLink = document.querySelector(`.nav-link[href="${hash}"]`);
                const activeView = document.querySelector(`${hash}-view`);
                
                if (activeLink && activeView) {
                    activeLink.classList.add('bg-gray-700', 'text-white');
                    activeView.classList.remove('hidden');
                    viewTitle.textContent = activeLink.textContent.trim();
                } else {
                    document.querySelector('.nav-link[href="#dashboard"]').classList.add('bg-gray-700', 'text-white');
                    document.getElementById('dashboard-view').classList.remove('hidden');
                    viewTitle.textContent = 'Dashboard';
                }
                
                if (hash === '#dashboard') renderDashboardView();
                if (hash === '#roadmap') renderRoadmapView();
                if (hash === '#progress') renderProgressView();
                if (hash === '#notebook') renderNotebookView();
                if (hash === '#chat') renderChatView();
            }

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.hash = new URL(link.href).hash;
                    if (window.innerWidth < 768) {
                        sidebar.classList.add('-translate-x-full');
                    }
                });
            });
            
            window.addEventListener('hashchange', () => switchView(window.location.hash));
            
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
            });

            // --- User Data Helpers (Notes, Progress) ---
            function getNote(topicId) { return localStorage.getItem(`note_${currentUser}_${topicId}`); }
            function saveNote(topicId, content) { localStorage.setItem(`note_${currentUser}_${topicId}`, content); }
            function getProgress(topicId) { return localStorage.getItem(`progress_${currentUser}_${topicId}`) === 'true'; }
            function saveProgress(topicId, isCompleted) { localStorage.setItem(`progress_${currentUser}_${topicId}`, isCompleted); }

            // --- Notes Logic ---
            function addNoteSavingListeners() {
                document.querySelectorAll('.save-note-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        const key = button.dataset.key;
                        const textarea = document.querySelector(`textarea[data-key="${key}"]`);
                        saveNote(key, textarea.value);
                        
                        const status = document.querySelector(`.note-status[data-key="${key}"]`);
                        status.style.opacity = '1';
                        setTimeout(() => { status.style.opacity = '0'; }, 2000);
                    });
                });
            }

            // --- Progress Tracking Logic ---
            function calculateStageProgress(stageId) {
                const stage = roadmapData.find(s => s.id === stageId);
                if (!stage) return 0;
                const totalTopics = stage.topics.length;
                if (totalTopics === 0) return 100;
                const completedTopics = stage.topics.filter(topic => getProgress(topic.id)).length;
                return (completedTopics / totalTopics) * 100;
            }

            function calculateOverallProgress() {
                const allTopics = roadmapData.flatMap(stage => stage.topics);
                const totalTopics = allTopics.length;
                if (totalTopics === 0) return 100;
                const completedTopics = allTopics.filter(topic => getProgress(topic.id)).length;
                return (completedTopics / totalTopics) * 100;
            }
            
            function getCompletedTopicCount() {
                return roadmapData.flatMap(stage => stage.topics).filter(topic => getProgress(topic.id)).length;
            }

            function addProgressCheckboxListeners() {
                document.querySelectorAll('.progress-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        saveProgress(e.target.dataset.topicId, e.target.checked);
                    });
                });
            }

            function updateProgressCheckboxes() {
                document.querySelectorAll('.progress-checkbox').forEach(checkbox => {
                    checkbox.checked = getProgress(checkbox.dataset.topicId);
                });
            }
            
            // --- Accordion Logic ---
            function addAccordionListeners() {
                document.querySelectorAll('.accordion-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                         if (e.target.type === 'checkbox') return;
                        const content = button.nextElementSibling;
                        content.classList.toggle('hidden');
                        const arrow = button.querySelector('.arrow');
                        arrow.classList.toggle('rotate-90');
                    });
                });
            }
            
            // --- Gemini API & Settings Logic ---
            const geminiModal = document.getElementById('gemini-modal');
            const geminiModalTitle = document.getElementById('gemini-modal-title');
            const geminiModalContent = document.getElementById('gemini-modal-content');
            const geminiModalClose = document.getElementById('gemini-modal-close');
            const loadingIndicator = document.getElementById('loading-indicator');
            const settingsBtn = document.getElementById('settings-btn');
            const settingsModalClose = document.getElementById('settings-modal-close');
            const saveApiKeyBtn = document.getElementById('save-api-key-btn');
            const apiKeyInput = document.getElementById('api-key-input');

            function showLoading(show) { loadingIndicator.classList.toggle('hidden', !show); }
            function showModal(title, content) {
                geminiModalTitle.textContent = title;
                geminiModalContent.innerHTML = content.replace(/\n/g, '<br>');
                geminiModal.classList.remove('hidden');
                setTimeout(() => geminiModal.classList.remove('opacity-0'), 10);
            }
            function hideModal(modal) {
                modal.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
            geminiModalClose.addEventListener('click', () => hideModal(geminiModal));
            settingsBtn.addEventListener('click', () => {
                apiKeyInput.value = localStorage.getItem('gemini_api_key') || '';
                settingsModal.classList.remove('hidden');
                setTimeout(() => settingsModal.classList.remove('opacity-0'), 10);
            });
            settingsModalClose.addEventListener('click', () => hideModal(settingsModal));
            saveApiKeyBtn.addEventListener('click', () => {
                localStorage.setItem('gemini_api_key', apiKeyInput.value);
                hideModal(settingsModal);
                alert('API Key saved successfully!');
            });


            async function callGeminiAPI(prompt) {
                const apiKey = localStorage.getItem('gemini_api_key');
                if (!apiKey) {
                    alert('Please set your Gemini API key in the settings first.');
                    settingsBtn.click();
                    return null;
                }
                showLoading(true);
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const result = await response.json();
                    if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        return result.candidates[0].content.parts[0].text;
                    }
                    return "рдорд╛рдлрд╝ рдХреАрдЬрд┐рдП, рдХреЛрдИ рдЬрд╡рд╛рдм рдирд╣реАрдВ рдорд┐рд▓рд╛ред";
                } catch (error) {
                    return `рдПрдХ рддреНрд░реБрдЯрд┐ рд╣реБрдИ: ${error.message}.`;
                } finally {
                    showLoading(false);
                }
            }

            async function handleGeminiRequest(prompt, modalTitle, modalContentProcessor) {
                const response = await callGeminiAPI(prompt);
                if (response) {
                    const processedContent = modalContentProcessor ? modalContentProcessor(response) : response;
                    showModal(modalTitle, processedContent);
                }
            }

            function addGeminiButtonListeners() {
                document.querySelectorAll('.gemini-explain-btn, .gemini-question-btn, .gemini-analogy-btn, .gemini-project-btn').forEach(button => {
                    button.addEventListener('click', async () => {
                        const topic = button.dataset.title;
                        let prompt, modalTitle;
                        if (button.classList.contains('gemini-explain-btn')) {
                            prompt = `"${topic}" рд╡рд┐рд╖рдп рдХреЛ рд╕рд░рд▓ рд╣рд┐рдВрджреА рдореЗрдВ, рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдордЭрд╛рдПрдВред`;
                            modalTitle = `'${topic}' рдХрд╛ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг`;
                        } else if (button.classList.contains('gemini-question-btn')) {
                            prompt = `"${topic}" рд╡рд┐рд╖рдп рдХреЗ рд▓рд┐рдП 3 рдмрд╣реБрд╡рд┐рдХрд▓реНрдкреАрдп рдЕрднреНрдпрд╛рд╕ рдкреНрд░рд╢реНрди (MCQs) рдЙрддреНрддрд░реЛрдВ рдХреЗ рд╕рд╛рде рд╣рд┐рдВрджреА рдореЗрдВ рдмрдирд╛рдПрдВред`;
                            modalTitle = `'${topic}' рдХреЗ рд▓рд┐рдП рдЕрднреНрдпрд╛рд╕ рдкреНрд░рд╢реНрди`;
                        } else if (button.classList.contains('gemini-analogy-btn')) {
                            prompt = `"${topic}" рдХреА рдЕрд╡рдзрд╛рд░рдгрд╛ рдХреЛ рдПрдХ рд╕рд░рд▓, рд╡рд╛рд╕реНрддрд╡рд┐рдХ рджреБрдирд┐рдпрд╛ рдХреЗ рд╕рд╛рджреГрд╢реНрдп (analogy) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рд┐рдВрджреА рдореЗрдВ рд╕рдордЭрд╛рдПрдВред`;
                            modalTitle = `'${topic}' рдХреЗ рд▓рд┐рдП Analogy`;
                        } else if (button.classList.contains('gemini-project-btn')) {
                            prompt = `"${topic}" рд╡рд┐рд╖рдп рдкрд░ рдПрдХ рд╢реБрд░реБрдЖрддреА рд╕реАрдЦрдиреЗ рд╡рд╛рд▓реЗ рдХреЗ рд▓рд┐рдП 3 рд░рдЪрдирд╛рддреНрдордХ рдФрд░ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╡рд┐рдЪрд╛рд░ (project ideas) рдПрдХ рд╕реВрдЪреА рдХреЗ рд░реВрдк рдореЗрдВ рд╣рд┐рдВрджреА рдореЗрдВ рджреЗрдВред`;
                            modalTitle = `'${topic}' рдХреЗ рд▓рд┐рдП Project Ideas`;
                        }
                        handleGeminiRequest(prompt, modalTitle);
                    });
                });
            }

            function addNoteGeminiListeners() {
                 document.querySelectorAll('.gemini-summary-btn').forEach(button => {
                    button.addEventListener('click', async () => {
                        const key = button.dataset.key;
                        const textarea = document.querySelector(`textarea[data-key="${key}"]`);
                        const noteContent = textarea.value;
                        if (!noteContent.trim()) {
                            alert('рдХреГрдкрдпрд╛ рд╕рд╛рд░рд╛рдВрд╢ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рдХреБрдЫ рдиреЛрдЯреНрд╕ рд▓рд┐рдЦреЗрдВред');
                            return;
                        }
                        const prompt = `рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдиреЛрдЯреНрд╕ рдХреЛ рдХреБрдЫ рдкреНрд░рдореБрдЦ рдмрд┐рдВрджреБрдУрдВ (key bullet points) рдореЗрдВ рд╣рд┐рдВрджреА рдореЗрдВ рд╕рд╛рд░рд╛рдВрд╢рд┐рдд рдХрд░реЗрдВред рдиреЛрдЯреНрд╕: "${noteContent}"`;
                        handleGeminiRequest(prompt, 'рдЖрдкрдХреЗ рдиреЛрдЯреНрд╕ рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢');
                    });
                });
            }
            
            // --- AI Chat Logic ---
            function addChatListeners() {
                const chatInput = document.getElementById('chat-input');
                const chatSendBtn = document.getElementById('chat-send-btn');
                const handleSend = async () => {
                    const userInput = chatInput.value.trim();
                    if (!userInput) return;
                    appendChatMessage(userInput, 'user');
                    chatInput.value = '';
                    const prompt = `You are an AI learning assistant. A user has asked the following question in Hindi: "${userInput}". Provide a helpful and clear answer in Hindi.`;
                    const aiResponse = await callGeminiAPI(prompt);
                    if (aiResponse) {
                        appendChatMessage(aiResponse, 'ai');
                    }
                };
                chatSendBtn.addEventListener('click', handleSend);
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') handleSend();
                });
            }

            function appendChatMessage(message, sender) {
                const chatHistory = document.getElementById('chat-history');
                const messageDiv = document.createElement('div');
                messageDiv.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
                const bubbleDiv = document.createElement('div');
                bubbleDiv.className = `chat-bubble p-3 rounded-lg ${sender === 'user' ? 'chat-bubble-user' : 'chat-bubble-ai'}`;
                bubbleDiv.innerHTML = message.replace(/\n/g, '<br>');
                messageDiv.appendChild(bubbleDiv);
                chatHistory.appendChild(messageDiv);
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }

            // --- Initial App Load ---
            function initializeApp() {
                authModal.classList.add('hidden');
                appContainer.classList.remove('hidden');
                usernameDisplay.textContent = currentUser.split('@')[0];
                switchView(window.location.hash || '#dashboard');
            }

            // Check for logged in user on start
            const savedUser = localStorage.getItem('drownford_currentUser');
            if (savedUser) {
                currentUser = savedUser;
                initializeApp();
            } else {
                renderAuthView();
            }
        });
    </script>
</body>
</html>
